<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Paths Forward: AI, Humanity, and the Next Era of Education</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        /* Loomis Chaffee Brand Colors */
        :root {
            --lc-red: #98252b;
            --lc-gray: #323e47;
            --cupola: #5CB8B7;
            --cupola-light: #A0D2D1;
            --river: #4E738A;
            --river-light: #92A6B5;
            --meadow: #FFDD7F;
            --meadow-light: #FFE8B0;
            --brick: #C25131;
            --brick-light: #E1947D;
            --accent-red: #FC5A5C;
            --pelican: #d1d5d8;
            --pelican-light: #e5e7eb;

            /* Colors for Time Blocks */
            --time-block-1: var(--lc-red);
            --time-block-1-light: #C77C77;
            --time-block-2: var(--meadow);
            --time-block-2-light: var(--meadow-light);
            --time-block-3: var(--brick);
            --time-block-3-light: var(--brick-light);

             /* Filter Tag Colors Cycle */
             --filter-color-1: var(--cupola-light);
             --filter-color-2: var(--river-light);
             --filter-color-3: var(--meadow-light);
             --filter-color-4: var(--brick-light);
             --filter-color-5: var(--pelican);
             --filter-text-color-1: var(--lc-gray);
             --filter-text-color-2: white;
             --filter-text-color-3: var(--lc-gray);
             --filter-text-color-4: white;
             --filter-text-color-5: var(--lc-gray);

             /* Active Filter Colors */
             --filter-active-color-1: var(--cupola);
             --filter-active-color-2: var(--river);
             --filter-active-color-3: var(--meadow);
             --filter-active-color-4: var(--brick);
             --filter-active-color-5: var(--lc-gray);
             --filter-active-text-color-1: white;
             --filter-active-text-color-2: white;
             --filter-active-text-color-3: var(--lc-gray);
             --filter-active-text-color-4: white;
             --filter-active-text-color-5: white;
        }

        body {
            /* Updated default font to Serif per request */
            font-family: 'Financier Display', Georgia, serif; /* Assuming Financier Display is loaded */
            color: var(--lc-gray);
            background-color: #f9f9f9;
            font-size: 16px;
            font-weight: 400; /* Default to regular weight */
        }

        /* Let headings inherit body font, adjust weights as needed */
        h1, h2, h3, h4, h5 {
             font-weight: 400; /* Reset to default, specific weights below */
        }
         h1 { font-size: 2.5rem; font-weight: 600; } /* Semi-Bold */
         h2 { font-size: 2rem; font-weight: 500; } /* Medium */
         h3 { font-size: 1.75rem; font-weight: 500; }
         /* Filter titles use the default serif font now */
         h4.filter-title {
             font-size: 1.1rem;
             font-weight: 600; /* Semi-Bold for filter titles */
             color: var(--lc-red);
             margin-bottom: 0.75rem;
         }
         h5 { font-size: 1.15rem; font-weight: 500; margin-bottom: 0.25rem;} /* Session titles */
         h6.card-subtitle {
             /* Inherits Financier Display */
             font-size: 0.9rem;
             margin-bottom: 0.5rem !important;
             font-weight: 400; /* Regular weight */
             color: #555; /* Slightly lighter subtitle */
         }


        .lc-header {
            background-color: var(--lc-red);
            color: white;
            padding: 1rem 0;
            display: flex;
            align-items: center;
        }

        .lc-header .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .lc-logo {
            height: 60px;
            width: auto;
        }

        .header-red {
            color: var(--lc-red);
        }

        .session-card {
            margin-bottom: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: opacity 0.3s ease-in-out, transform 0.2s ease-out;
            background-color: white;
            overflow: hidden;
        }
        .session-card:hover {
             transform: translateY(-3px);
             box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        }


        .session-card .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            padding: 0.6rem 1rem;
        }

        .tag { /* General tag styling */
            display: inline-block;
            padding: 0.25rem 0.6rem;
            margin-right: 0.4rem;
            margin-bottom: 0.4rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1.2;
            border: 1px solid transparent;
            /* Inherits body font */
        }

        /* Strand Tags in Header */
        .tag.strand-ai-classroom { background-color: var(--cupola); color: white; }
        .tag.strand-human-centered { background-color: var(--brick); color: white; }
        .tag.strand-leadership { background-color: var(--lc-gray); color: white; }

        /* Session Type Badges in Header */
         .badge.session-type {
             font-weight: 500;
             font-size: 0.75rem;
             padding: 0.25rem 0.6rem;
             border-radius: 15px;
             color: white;
             /* Inherits body font */
         }
        .badge.type-workshop { background-color: var(--lc-red) !important; }
        .badge.type-presentation { background-color: var(--meadow) !important; color: var(--lc-gray) !important; }
        .badge.type-discussion { background-color: var(--brick) !important; }

        /* Card Body and Borders */
        .session-card .card-body {
            padding: 0.5rem 1rem; /* Reduced padding */
            border-left: 5px solid transparent;
        }
        .session-card.strand1 .card-body { border-left-color: var(--cupola); }
        .session-card.strand2 .card-body { border-left-color: var(--brick); }
        .session-card.strand3 .card-body { border-left-color: var(--lc-gray); }


        .filter-group {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 1rem;
        }

         .filter-group-wrapper {
            position: sticky;
            top: 20px;
         }

        /* --- Filter Button Styles --- */
        .filter-buttons-container {
             display: flex;
             flex-wrap: wrap;
             gap: 0.4rem;
        }

        .btn-filter {
            appearance: none;
            background: none;
            border: none;
            font: inherit; /* Inherit Financier Display from body */
            cursor: pointer;
            outline: inherit;
            display: inline-block;
            padding: 0.3rem 0.7rem;
            margin: 0;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 400; /* Regular weight */
            line-height: 1.2;
            text-align: center;
            border: 1px solid #ddd;
            transition: all 0.2s ease-in-out;
            opacity: 0.9;
            background-color: var(--pelican-light);
            color: var(--lc-gray);
        }

        .btn-filter:hover {
            opacity: 1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .btn-filter.active {
            opacity: 1;
            font-weight: 600; /* Semi-Bold weight when active */
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
            border-width: 1px;
            transform: scale(1.02);
        }

        /* General 'All' button style */
        .btn-filter-all {
            background-color: var(--pelican);
            color: var(--lc-gray);
            font-weight: 600; /* Semi-Bold 'All' button */
            border-color: #bbb;
        }
        .btn-filter-all.active {
            background-color: var(--lc-gray);
            color: white;
            border-color: var(--lc-gray);
        }

        /* Specific Filter Button Colors */
        .btn-filter.color-1 { background-color: var(--filter-color-1); color: var(--filter-text-color-1); border-color: var(--filter-color-1); }
        .btn-filter.color-2 { background-color: var(--filter-color-2); color: var(--filter-text-color-2); border-color: var(--filter-color-2); }
        .btn-filter.color-3 { background-color: var(--filter-color-3); color: var(--filter-text-color-3); border-color: var(--filter-color-3); }
        .btn-filter.color-4 { background-color: var(--filter-color-4); color: var(--filter-text-color-4); border-color: var(--filter-color-4); }
        .btn-filter.color-5 { background-color: var(--filter-color-5); color: var(--filter-text-color-5); border-color: var(--filter-color-5); }

        .btn-filter.color-1.active { background-color: var(--filter-active-color-1); color: var(--filter-active-text-color-1); border-color: var(--filter-active-color-1); }
        .btn-filter.color-2.active { background-color: var(--filter-active-color-2); color: var(--filter-active-text-color-2); border-color: var(--filter-active-color-2); }
        .btn-filter.color-3.active { background-color: var(--filter-active-color-3); color: var(--filter-active-text-color-3); border-color: var(--filter-active-color-3); }
        .btn-filter.color-4.active { background-color: var(--filter-active-color-4); color: var(--filter-active-text-color-4); border-color: var(--filter-active-color-4); }
        .btn-filter.color-5.active { background-color: var(--filter-active-color-5); color: var(--filter-active-text-color-5); border-color: var(--filter-active-color-5); }

        /* --- End Filter Button Styles --- */

        footer {
            background-color: var(--lc-gray);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .hidden {
            display: none !important;
        }

        /* --- NEW Description Expansion Styles --- */
        .session-description-wrapper {
            position: relative;
            overflow: hidden; /* Important for max-height */
            /* Set max-height for collapsed state (e.g., approx 3 lines) */
            max-height: 4.5em; /* Adjust this value (line-height * lines) */
            transition: max-height 0.4s ease-in-out; /* Smooth transition */
            cursor: pointer; /* Indicate it's clickable (optional) */
            margin-bottom: 0.5rem; /* Space before button */
            /* Add a fade-out effect when collapsed */
            -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
        }

        .session-description-wrapper.expanded {
            max-height: 1000px; /* Large enough value for any content */
            cursor: default;
            /* Remove fade-out when expanded */
            -webkit-mask-image: none;
            mask-image: none;
        }

        .session-description-content {
            /* Styles for the actual text content */
            font-size: 0.9rem;
            line-height: 1.5; /* Use this to calculate max-height */
            color: var(--lc-gray);
             white-space: pre-wrap; /* Respect newlines from HTML */
        }
        /* Remove <p> margins if description_html uses them */
        .session-description-content p {
            margin-bottom: 0.5em; /* Space between paragraphs */
        }
        .session-description-content p:last-child {
             margin-bottom: 0; /* No extra space after last paragraph */
        }

        /* Toggle button style */
         .toggle-description {
             background-color: transparent;
             border: 1px solid var(--lc-gray);
             color: var(--lc-gray);
             padding: 0.2rem 0.6rem;
             border-radius: 4px;
             font-size: 0.75rem;
             cursor: pointer;
             transition: background-color 0.2s, color 0.2s;
             /* margin-top: 0; /* Removed top margin, handled by wrapper */
             font-weight: 400; /* Regular weight */
         }
         .toggle-description:hover {
             background-color: var(--lc-gray);
             color: white;
         }
        /* --- END Description Expansion Styles --- */


        .session-badge-container {
             display: flex;
             gap: 0.4rem;
             align-items: center;
        }

        /* Session details badges (Time, Location) */
        .session-details {
            margin-top: 0.1rem;
            margin-bottom: 0.1rem; /* Reduced margin */
            display: flex;
            flex-wrap: wrap;
            gap: 0.1rem;
        }

        .session-details .badge {
            font-weight: 400;
            font-size: 0.8rem;
            padding: 0.3rem 0.7rem;
            background-color: var(--pelican) !important;
            color: var(--lc-gray) !important;
            border: none;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            /* Inherits body font */
        }

        .session-details .badge i {
            margin-right: 4px;
            font-size: 0.9em;
        }

        /* Tags section within the card body */
        .session-tags {
            margin-top: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid #eee;
        }
        .session-tags .tag {
             background-color: var(--pelican-light);
             color: var(--lc-gray);
             border: 1px solid var(--pelican);
             font-size: 0.7rem;
             padding: 0.2rem 0.5rem;
             margin-bottom: 0.25rem;
             margin-right: 0.25rem;
        }
        .session-tags strong {
            font-size: 0.8rem;
            font-weight: 600; /* Semi-Bold label */
            color: var(--lc-gray);
            display: block;
            margin-bottom: 0.25rem;
        }


        /* Loading indicator styles */
        #loading {
            text-align: center;
            padding: 40px 20px;
            font-size: 1.2rem;
            color: var(--lc-red);
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            margin-bottom: 1rem;
            color: var(--lc-red);
        }

        /* No results message */
        #no-results {
             margin-top: 2rem;
             padding: 1.5rem;
             font-size: 1.1rem;
        }

         /* Search button style */
         #search-button {
             border-color: var(--lc-gray);
             color: var(--lc-gray);
         }
         #search-button:hover {
             background-color: var(--lc-gray);
             color: white;
         }
         /* Clear button style */
         #clear-filters-button {
             border-color: var(--lc-red);
             color: var(--lc-red);
             font-weight: 600; /* Semi-Bold clear button */
         }
         #clear-filters-button:hover {
             background-color: var(--lc-red);
             color: white;
         }

        .card-title {
            margin-bottom: 0.5rem; /* Reduced margin */
        }
        .card-subtitle {
            margin-bottom: 0.25rem; /* Reduced margin */
        }
        .session-description-wrapper {
            margin-top: 0.1rem;  /* Reduced top margin */
            margin-bottom: 0.1rem;  /* Reduced bottom margin */
        }

    </style>
</head>
<body>
    <header class="lc-header">
        <div class="container">
            <img src="logo.png" alt="Loomis Chaffee Logo" class="lc-logo" onerror="this.style.display='none'; console.error('Logo image not found.');">
        </div>
    </header>

    <div class="container py-4"> <div class="row">
            <div class="col-lg-3">
                <div class="filter-group-wrapper">
                    <div class="filter-group">
                        <h4 class="filter-title">Filter by Strand</h4>
                        <div class="filter-buttons-container" id="strand-filters">
                            <button class="btn btn-filter btn-filter-all active" data-filter="all" onclick="toggleFilter('strand', 'all', this)">All Strands</button>
                            <button class="btn btn-filter color-1" data-filter="strand1" onclick="toggleFilter('strand', 'strand1', this)">1: AI in the Classroom</button>
                            <button class="btn btn-filter color-2" data-filter="strand2" onclick="toggleFilter('strand', 'strand2', this)">2: Human-Centered Innovation</button>
                            <button class="btn btn-filter color-5" data-filter="strand3" onclick="toggleFilter('strand', 'strand3', this)">3: Leadership in AI</button>
                        </div>
                    </div>

                    <div class="filter-group">
                        <h4 class="filter-title">Filter by Time Block</h4>
                        <div class="filter-buttons-container" id="timeblock-filters">
                            <button class="btn btn-filter btn-filter-all active" data-filter="all" onclick="toggleFilter('timeblock', 'all', this)">All Time Blocks</button>
                            <button class="btn btn-filter color-1" data-filter="1" onclick="toggleFilter('timeblock', '1', this)">Block 1</button>
                            <button class="btn btn-filter color-3" data-filter="2" onclick="toggleFilter('timeblock', '2', this)">Block 2</button>
                            <button class="btn btn-filter color-4" data-filter="3" onclick="toggleFilter('timeblock', '3', this)">Block 3</button>
                        </div>
                    </div>

                    <div class="filter-group">
                        <h4 class="filter-title">Filter by Tag</h4>
                        <div class="filter-buttons-container" id="tag-filters">
                            <button class="btn btn-filter btn-filter-all active" data-filter="all" onclick="toggleFilter('tag', 'all', this)">All Tags</button>
                            </div>
                    </div>

                    <div class="filter-group">
                        <h4 class="filter-title">Search & Clear</h4>
                        <div class="input-group mb-2"> <input type="text" id="search-input" class="form-control form-control-sm" placeholder="Search sessions..."> <button id="search-button" class="btn btn-outline-secondary btn-sm" type="button" onclick="applyFilters()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                        <button id="clear-filters-button" class="btn btn-outline-secondary btn-sm w-100" onclick="resetAllFilters()">Clear All Filters</button> </div>
                </div>
            </div>

            <div class="col-lg-9">
                <h2 class="mb-3 header-red">Conference Sessions</h2> <div id="sessions-container">
                    <div id="loading">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p>Loading session data...</p>
                    </div>
                    <div id="no-results" class="alert alert-warning hidden" role="alert">
                        No sessions match your criteria. Please adjust your filters or search term.
                    </div>
                    </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <h4>Loomis Chaffee</h4>
                    <p class="mb-0">4 Batchelder Road, Windsor, CT 06095</p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <p class="mb-0">&copy; 2025 Loomis Chaffee School</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // NOTE: This script assumes the fonts 'Proxima Nova' and 'Financier Display'
        // are loaded globally via the website's main CSS or a font service.
        document.addEventListener('DOMContentLoaded', function() {
            const sessionsContainer = document.getElementById('sessions-container');
            const loadingElement = document.getElementById('loading');
            const noResultsDiv = document.getElementById('no-results');
            const searchInput = document.getElementById('search-input');
            const tagFiltersContainer = document.getElementById('tag-filters');
            const strandFiltersContainer = document.getElementById('strand-filters');

            let allSessionData = [];
            let allTags = new Set();
            let allStrands = new Set();

            const activeFilters = {
                strand: ['all'],
                timeblock: ['all'],
                tag: ['all']
            };

            // --- Function to create HTML for tags (Limited to 5) ---
            function createTagsHtml(tags) {
                if (!tags || tags.length === 0) return '';
                const limitedTags = tags.slice(0, 5);
                const tagSpans = limitedTags.map(tag => `<span class="tag">${tag}</span>`).join('');
                const ellipsis = tags.length > 5 ? '<span class="tag" title="More tags exist...">...</span>' : '';
                // Added "Tags:" label directly here
                return `<div class="session-tags"><strong>Tags:</strong><div class="mt-1">${tagSpans}${ellipsis}</div></div>`;
            }

            // --- Function to create a session card ---
            function createSessionCard(session, index) {
                let strandClass = 'strand-unknown';
                if (session.strand === "strand1") strandClass = "strand-ai-classroom";
                else if (session.strand === "strand2") strandClass = "strand-human-centered";
                else if (session.strand === "strand3") strandClass = "strand-leadership";

                let typeBadgeClass = 'type-workshop';
                if (session.type === 'type-presentation') typeBadgeClass = 'type-presentation';
                if (session.type === 'type-discussion') typeBadgeClass = 'type-discussion';

                const tagsHtml = createTagsHtml(session.tags);
                const formattedDescription = (session.description || '').replace(
                    /(https?:\/\/[^\s]+)/g,
                    '<a href="$1" target="_blank" rel="noopener noreferrer">$1</a>'
                );
                const cardHtml = `
                    <div class="card session-card mb-3 ${session.strand} ${session.type}"
                         data-strand="${session.strand || 'all'}"
                         data-timeblock="${session.timeBlock || 'all'}"
                         data-tags="${(session.tags || []).join(',')}"
                         data-index="${index}">
                        <div class="card-header d-flex justify-content-between align-items-center" onclick="toggleDescription(event, 'desc-wrapper-${index}')" style="cursor: pointer;">
                            <span class="tag ${strandClass}">${session.strandName || 'Unknown Strand'}</span>
                             <div class="session-badge-container">
                                <span class="badge session-type ${typeBadgeClass}">${session.typeName}</span>
                             </div>
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">${session.title}</h5>
                            <h6 class="card-subtitle text-muted">${session.presenter}</h6>
                            <div class="session-details">
                                <span class="badge"><i class="bi bi-clock"></i> Block: ${session.timeBlock || 'TBD'}</span>
                                <span class="badge"><i class="bi bi-geo-alt"></i> Location: ${session.location || 'TBD'}</span>
                            </div>

                            <div class="session-description-wrapper" id="desc-wrapper-${index}">
                                <div class="session-description-content">
                                    ${formattedDescription}
                                </div>
                            </div>

                            <button class="btn btn-sm toggle-description"
                                     onclick="toggleDescription(event, 'desc-wrapper-${index}')">Read More</button>

                            ${tagsHtml}
                        </div>
                    </div>`;
                return cardHtml;
            }

            // --- Function to populate tag filter buttons ---
            function populateTagFilters() {
                const allTagsButton = tagFiltersContainer.querySelector('.btn-filter-all');
                tagFiltersContainer.innerHTML = '';
                tagFiltersContainer.appendChild(allTagsButton);

                const sortedTags = Array.from(allTags).sort();
                sortedTags.forEach((tag, index) => {
                    const button = document.createElement('button');
                    const colorClass = `color-${(index % 5) + 1}`;
                    button.className = `btn btn-filter ${colorClass}`;
                    const filterValue = tag.toLowerCase().replace(/\s+/g, '-');
                    button.dataset.filter = filterValue;
                    button.textContent = tag;
                    button.onclick = () => toggleFilter('tag', filterValue, button);
                    tagFiltersContainer.appendChild(button);
                });
            }

            // --- Function to update strand filters ---
            function updateStrandFilters() {
                const existingStrandFilters = new Set();
                strandFiltersContainer.querySelectorAll('button[data-filter]').forEach(btn => {
                    if (btn.dataset.filter !== 'all') existingStrandFilters.add(btn.dataset.filter);
                });

                allStrands.forEach(strandData => {
                    if (!existingStrandFilters.has(strandData.id)) {
                        const button = document.createElement('button');
                        const colorIndex = parseInt(strandData.id.replace('strand', ''), 10) || 5;
                        const colorClass = `color-${(colorIndex % 5) + 1}`;
                        button.className = `btn btn-filter ${colorClass}`;
                        button.dataset.filter = strandData.id;
                        button.textContent = strandData.name;
                        button.onclick = () => toggleFilter('strand', strandData.id, button);
                        strandFiltersContainer.appendChild(button);
                    }
                });
            }

            // --- Function to load session data ---
            async function loadSessionData() {
                try {
                    const response = await fetch('sessions.json');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    allSessionData = await response.json();
                    // Added: Function to shuffle the sessions pseudo-randomly
                    function shuffle(array) {
                        for (let i = array.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [array[i], array[j]] = [array[j], array[i]];
                        }
                    }
                    shuffle(allSessionData);
                    if (loadingElement) loadingElement.remove();
                    sessionsContainer.querySelectorAll('.session-card').forEach(card => card.remove());
                    allSessionData.forEach((session, index) => {
                        if (session.tags && Array.isArray(session.tags)) {
                            session.tags.forEach(tag => allTags.add(tag));
                        }
                        if (session.strand && session.strandName) {
                             allStrands.add({ id: session.strand, name: session.strandName });
                        }
                        const sessionCardHtml = createSessionCard(session, index);
                        noResultsDiv.insertAdjacentHTML('beforebegin', sessionCardHtml);
                    });

                    updateStrandFilters();
                    populateTagFilters();
                    applyFilters();

                } catch (error) {
                    console.error('Error loading session data:', error);
                    const errorHtml = `<div class="alert alert-danger" role="alert">Error loading session data. Please check console.</div>`;
                    if (loadingElement) loadingElement.innerHTML = errorHtml;
                    else sessionsContainer.insertAdjacentHTML('afterbegin', errorHtml);
                }
            }

            loadSessionData();

            // --- Function to toggle description visibility (NEW - uses CSS class) ---
            window.toggleDescription = function(event, wrapperId) {
                event.preventDefault();
                const button = event.currentTarget;
                const wrapper = document.getElementById(wrapperId); // Get the wrapper div

                if (wrapper) {
                    const isExpanded = wrapper.classList.contains('expanded');
                    wrapper.classList.toggle('expanded'); // Toggle the class
                    button.textContent = isExpanded ? 'Read More' : 'Show Less'; // Update button text
                } else {
                    console.warn("Could not find description wrapper for ID:", wrapperId);
                }
            }

            // --- Function to handle filter button clicks ---
            window.toggleFilter = function(group, value, element) {
                const filterGroup = activeFilters[group];
                const allButton = document.querySelector(`#${group}-filters .btn-filter-all`);

                if (value === 'all') {
                    if (!element.classList.contains('active')) {
                        document.querySelectorAll(`#${group}-filters .btn-filter`).forEach(btn => btn.classList.remove('active'));
                        element.classList.add('active');
                        activeFilters[group] = ['all'];
                    }
                } else {
                    if (allButton && allButton.classList.contains('active')) {
                        allButton.classList.remove('active');
                        activeFilters[group] = [];
                    }
                    if (element.classList.contains('active')) {
                        element.classList.remove('active');
                        activeFilters[group] = filterGroup.filter(f => f !== value);
                    } else {
                        element.classList.add('active');
                        activeFilters[group].push(value);
                    }
                    if (activeFilters[group].length === 0 && allButton) {
                        allButton.classList.add('active');
                        activeFilters[group] = ['all'];
                    }
                }
                applyFilters();
            }

            // --- Function to apply filters ---
            window.applyFilters = function() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                let visibleCount = 0;
                const allSessionCards = sessionsContainer.querySelectorAll('.session-card');

                allSessionCards.forEach(card => {
                    const cardStrand = card.dataset.strand || 'all';
                    const cardTimeBlock = card.dataset.timeblock || 'all';
                    const cardTags = (card.dataset.tags || '').split(',').filter(t => t);
                    let showCard = true;

                    // Strand Filter
                    if (!activeFilters.strand.includes('all') && !activeFilters.strand.includes(cardStrand)) showCard = false;
                    // Time Block Filter
                    if (showCard && !activeFilters.timeblock.includes('all') && !activeFilters.timeblock.includes(cardTimeBlock)) showCard = false;
                    // Tag Filter
                    if (showCard && !activeFilters.tag.includes('all')) {
                         const cardTagFilters = cardTags.map(tag => tag.toLowerCase().replace(/\s+/g, '-'));
                         const hasActiveTag = activeFilters.tag.some(activeTag => cardTagFilters.includes(activeTag));
                         if (!hasActiveTag) showCard = false;
                    }
                    // Search Filter
                    if (showCard && searchTerm !== '') {
                        const title = card.querySelector('.card-title')?.textContent.toLowerCase() || '';
                        const presenter = card.querySelector('.card-subtitle')?.textContent.toLowerCase() || '';
                        // Search the actual description content now
                        const description = card.querySelector('.session-description-content')?.textContent.toLowerCase() || '';
                        const tagsText = cardTags.join(' ').toLowerCase();
                        const combinedText = `${title} ${presenter} ${description} ${tagsText}`; // Use full description for search
                        if (!combinedText.includes(searchTerm)) showCard = false;
                    }

                    // Show/Hide Card & Collapse Description if hiding
                    card.classList.toggle('hidden', !showCard);
                    if (!showCard) {
                        const wrapper = card.querySelector('.session-description-wrapper');
                        if (wrapper && wrapper.classList.contains('expanded')) {
                             wrapper.classList.remove('expanded');
                             card.querySelector('.toggle-description').textContent = 'Read More';
                        }
                    } else {
                        visibleCount++;
                    }
                });

                noResultsDiv.classList.toggle('hidden', visibleCount > 0);
            }

            // --- Function to reset filters ---
            window.resetAllFilters = function() {
                activeFilters.strand = ['all'];
                activeFilters.timeblock = ['all'];
                activeFilters.tag = ['all'];

                ['strand', 'timeblock', 'tag'].forEach(group => {
                     document.querySelectorAll(`#${group}-filters .btn-filter`).forEach(button => {
                         button.classList.toggle('active', button.dataset.filter === 'all');
                     });
                 });

                searchInput.value = '';
                applyFilters();
            }

            // --- Event Listeners ---
            searchInput.addEventListener('input', applyFilters);
            searchInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    applyFilters();
                }
            });

        }); // End DOMContentLoaded
    </script>
</body>
</html>
