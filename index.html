<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>New Paths Forward: AI, Humanity, and the Next Era of Education</title>
<!-- Add favicon -->
<link href="favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Fallback text-based favicon if favicon.ico doesn't exist -->
<link href="data:image/svg+xml,&lt;svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'&gt;&lt;text y='.9em' font-size='90' font-family='serif' font-weight='bold' fill='%2398252b'&gt;LC&lt;/text&gt;&lt;/svg&gt;" rel="icon"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet"/>
<style>
        /* Loomis Chaffee Brand Colors */
        :root {
            --lc-red: #98252b;
            --lc-gray: #323e47;
            --cupola: #5CB8B7;
            --cupola-light: #A0D2D1;
            --river: #4E738A;
            --river-light: #92A6B5;
            --meadow: #FFDD7F;
            --meadow-light: #FFE8B0;
            --brick: #C25131;
            --brick-light: #E1947D;
            --accent-red: #FC5A5C;
            --pelican: #d1d5d8;
            --pelican-light: #e5e7eb;

            /* Colors for Time Blocks */
            --time-block-1: var(--lc-red);
            --time-block-1-light: #C77C77;
            --time-block-2: var(--meadow);
            --time-block-2-light: var(--meadow-light);
            --time-block-3: var(--brick);
            --time-block-3-light: var(--brick-light);

             /* Filter Tag Colors Cycle */
             --filter-color-1: var(--cupola-light);
             --filter-color-2: var(--river-light);
             --filter-color-3: var(--meadow-light);
             --filter-color-4: var(--brick-light);
             --filter-color-5: var(--pelican);
             --filter-text-color-1: var(--lc-gray);
             --filter-text-color-2: white;
             --filter-text-color-3: var(--lc-gray);
             --filter-text-color-4: white;
             --filter-text-color-5: var(--lc-gray);

             /* Active Filter Colors */
             --filter-active-color-1: var(--cupola);
             --filter-active-color-2: var(--river);
             --filter-active-color-3: var(--meadow);
             --filter-active-color-4: var(--brick);
             --filter-active-color-5: var(--lc-gray);
             --filter-active-text-color-1: white;
             --filter-active-text-color-2: white;
             --filter-active-text-color-3: var(--lc-gray);
             --filter-active-text-color-4: white;
             --filter-active-text-color-5: white;
        }

        body {
            /* Updated default font to Serif per request */
            font-family: 'Financier Display', Georgia, serif; /* Assuming Financier Display is loaded */
            color: var(--lc-gray);
            background-color: #f9f9f9;
            font-size: 16px;
            font-weight: 400; /* Default to regular weight */
        }

        /* Let headings inherit body font, adjust weights as needed */
        h1, h2, h3, h4, h5 {
             font-weight: 400; /* Reset to default, specific weights below */
        }
         h1 { font-size: 2.5rem; font-weight: 600; } /* Semi-Bold */
         h2 { font-size: 2rem; font-weight: 500; } /* Medium */
         h3 { font-size: 1.75rem; font-weight: 500; }
         /* Filter titles use the default serif font now */
         h4.filter-title {
             font-size: 1.1rem; 
             font-weight: 500; /* Medium weight */
             color: var(--lc-gray); /* Use main gray color */
             margin-bottom: 0.75rem;
         }
         h5 { font-size: 1.15rem; font-weight: 500; margin-bottom: 0.25rem;} /* Session titles */
         h6.card-subtitle {
             /* Inherits Financier Display */
             font-size: 0.9rem;
             margin-bottom: 0.5rem !important;
             font-weight: 400; /* Regular weight */
             color: #555; /* Slightly lighter subtitle */
         }


        .lc-header {
            background-color: var(--lc-red);
            color: white;
            padding: 1rem 0;
            display: flex;
            align-items: center;
        }

        .lc-header .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .lc-logo {
            height: 60px;
            width: auto;
        }

        .header-red {
            color: var(--lc-red);
        }

        /* Navigation tab styling */
        .nav-tabs {
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--lc-red);
        }

        .nav-tabs .nav-link {
            color: var(--lc-gray);
            font-weight: 500;
            border: none;
            padding: 0.75rem 1.5rem;
        }

        .nav-tabs .nav-link.active {
            color: white;
            background-color: var(--lc-red);
        }

        .session-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .session-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
            z-index: 2;
        }

        .session-card .session-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--lc-gray);
            /* padding-right: 90px; */ /* Removed padding */
            /* NEW Flexbox solution */
            display: flex;
            justify-content: space-between; /* Pushes title and (future) badge apart */
            align-items: flex-start; /* Align items at the top */
            /* The title itself should not shrink if the badge is present */
        }

        .session-card .session-title > span { /* Wrap title text in a span for flex control */
            flex-grow: 1; /* Allows title to take available space */
            padding-right: 5px; /* Small space between title and where badge would be if inline */
        }

        .session-card .session-presenter {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 0.75rem;
        }

        .session-card .session-room,
        .session-card .session-time { /* session-time might be new for index/schedule */
            font-size: 0.85rem;
            color: var(--lc-gray);
            margin-bottom: 0.25rem;
            font-weight: 500;
        }

        .session-card .session-meta-item { /* For icon + text, e.g., room/time */
            display: flex;
            align-items: center;
            margin-bottom: 0.3rem;
            font-size: 0.85rem;
            color: var(--lc-gray);
            font-weight: 500;
        }
        .session-card .session-meta-item i { /* For Bootstrap Icons */
            margin-right: 0.4rem;
            color: var(--lc-red);
            font-size: 0.9em;
            line-height: 1;
        }

        .session-card .session-tags {
            margin-top: auto;
            padding-top: 0.5rem;
        }

        /* Strand indicator on the left */
        .session-card .strand-indicator {
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
        }
        .session-card.strand1 .strand-indicator { background-color: var(--cupola); }
        .session-card.strand2 .strand-indicator { background-color: var(--brick); }
        .session-card.strand3 .strand-indicator { background-color: var(--lc-gray); }
        .session-card.strandSpecial .strand-indicator { background-color: var(--meadow); }

        /* Session type badge on the top right */
        .session-card .session-type {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            color: white;
            line-height: 1;
            /* text-transform: uppercase; */ /* REMOVED to prevent all caps */
        }

        .session-card .type-workshop { background-color: var(--lc-red); color: white; }
        .session-card .type-presentation { background-color: var(--meadow); color: var(--lc-gray); }
        .session-card .type-discussion { background-color: var(--brick); color: white; }
        .session-card .type-panel { background-color: var(--river); color: white; }
        .session-card .type-keynote { background-color: var(--lc-gray); color: white; }
        .session-card .type-facilitated { background-color: var(--cupola); color: white; }
        .session-card .type-special { background-color: var(--pelican); color: var(--lc-gray); }
        .session-card .type-placeholder,
        .session-card .type-default {
             background-color: var(--pelican-light); color: var(--lc-gray);
        }

        /* === TAG STYLES (Derived from calendar.html) === */
        .tag {
            display: inline-block;
            padding: 0.3rem 0.7rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
            line-height: 1;
            border: 1px solid transparent;
            background-color: var(--pelican-light);
            color: var(--lc-gray);
        }
        .tag:hover {
            background-color: var(--pelican);
            border-color: var(--lc-gray);
        }
        /* === END TAG STYLES === */

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .session-card {
                flex-direction: column;
                height: auto;
            }
        }

        /* --- Filter Button Styles --- */
        .filter-buttons-container {
             display: flex;
             flex-wrap: wrap;
             gap: 0.4rem;
        }

        .btn-filter {
            appearance: none;
            background: none;
            border: none;
            font: inherit; /* Inherit Financier Display from body */
            cursor: pointer;
            outline: inherit;
            display: inline-block;
            padding: 0.3rem 0.7rem;
            margin: 0;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 400; /* Regular weight */
            line-height: 1.2;
            text-align: center;
            border: 1px solid #ddd;
            transition: all 0.2s ease-in-out;
            opacity: 0.9;
            background-color: var(--pelican-light);
            color: var(--lc-gray);
        }

        .btn-filter:hover {
            opacity: 1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .btn-filter.active {
            opacity: 1;
            font-weight: 600; /* Semi-Bold weight when active */
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
            border-width: 1px;
            transform: scale(1.02);
        }

        /* General 'All' button style */
        .btn-filter-all {
            background-color: var(--pelican);
            color: var(--lc-gray);
            font-weight: 600; /* Semi-Bold 'All' button */
            border-color: #bbb;
        }
        .btn-filter-all.active {
            background-color: var(--lc-gray);
            color: white;
            border-color: var(--lc-gray);
        }

        /* Specific Filter Button Colors */
        .btn-filter.color-1 { background-color: var(--filter-color-1); color: var(--filter-text-color-1); border-color: var(--filter-color-1); }
        .btn-filter.color-2 { background-color: var(--filter-color-2); color: var(--filter-text-color-2); border-color: var(--filter-color-2); }
        .btn-filter.color-3 { background-color: var(--filter-color-3); color: var(--filter-text-color-3); border-color: var(--filter-color-3); }
        .btn-filter.color-4 { background-color: var(--filter-color-4); color: var(--filter-text-color-4); border-color: var(--filter-color-4); }
        .btn-filter.color-5 { background-color: var(--filter-color-5); color: var(--filter-text-color-5); border-color: var(--filter-color-5); }

        .btn-filter.color-1.active { background-color: var(--filter-active-color-1); color: var(--filter-active-text-color-1); border-color: var(--filter-active-color-1); }
        .btn-filter.color-2.active { background-color: var(--filter-active-color-2); color: var(--filter-active-text-color-2); border-color: var(--filter-active-color-2); }
        .btn-filter.color-3.active { background-color: var(--filter-active-color-3); color: var(--filter-active-text-color-3); border-color: var(--filter-active-color-3); }
        .btn-filter.color-4.active { background-color: var(--filter-active-color-4); color: var(--filter-active-text-color-4); border-color: var(--filter-active-color-4); }
        .btn-filter.color-5.active { background-color: var(--filter-active-color-5); color: var(--filter-active-text-color-5); border-color: var(--filter-active-color-5); }

        /* --- End Filter Button Styles --- */

        footer {
            background-color: var(--lc-gray);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .hidden {
            display: none !important;
        }

        /* --- NEW Description Expansion Styles --- */
        .session-description-wrapper {
            position: relative;
            overflow: hidden; /* Important for max-height */
            /* Set max-height for collapsed state (e.g., approx 3 lines) */
            max-height: 4.5em; /* Adjust this value (line-height * lines) */
            transition: max-height 0.4s ease-in-out; /* Smooth transition */
            /* cursor: pointer; */ /* Removed, button handles click */
            margin-bottom: 0.5rem; /* Space before button */
            /* Add a fade-out effect when collapsed */
            -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
        }

        .session-description-wrapper.expanded {
            max-height: 1000px; /* Large enough value for any content */
            cursor: default;
            /* Remove fade-out when expanded */
            -webkit-mask-image: none;
            mask-image: none;
        }

        .session-description-content {
            /* Styles for the actual text content */
            font-size: 0.9rem;
            line-height: 1.5; /* Use this to calculate max-height */
            color: var(--lc-gray);
             white-space: pre-wrap; /* Respect newlines from HTML */
        }
        /* Remove <p> margins if description_html uses them */
        .session-description-content p {
            margin-bottom: 0.5em; /* Space between paragraphs */
        }
        .session-description-content p:last-child {
             margin-bottom: 0; /* No extra space after last paragraph */
        }

        /* Toggle button style */
         .toggle-description {
             background-color: transparent;
             border: 1px solid var(--lc-gray);
             color: var(--lc-gray);
             padding: 0.1rem 0.4rem; /* Made button smaller */
             border-radius: 3px; /* Adjusted border-radius */
             font-size: 0.65rem; /* Made button smaller */
             cursor: pointer;
             transition: background-color 0.2s, color 0.2s;
             font-weight: 400; /* Regular weight */
             /* float: right; */ /* Removed float right for left alignment */
             /* margin-top: 0.25rem; */ /* Removed margin-top */
             margin-bottom: 0.5rem; /* Add some space below the button */
             align-self: flex-start; /* Align button to the left within flex container */
         }
         .toggle-description:hover {
             background-color: var(--lc-gray);
             color: white;
         }
        /* --- END Description Expansion Styles --- */


        .session-badge-container {
             display: flex;
             gap: 0.4rem;
             align-items: center;
        }

        /* Session details badges (Time, Location) */
        .session-details {
            margin-top: 0.5rem !important;    /* Increased from 0.1rem */
            margin-bottom: 0.75rem !important; /* Increased from 0.1rem */
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;  /* Increased from 0.1rem */
        }

        .session-details .badge {
            font-weight: 400;
            font-size: 0.8rem;
            padding: 0.3rem 0.7rem;
            background-color: var(--pelican) !important;
            color: var(--lc-gray) !important;
            border: none;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            /* Inherits body font */
        }

        .session-details .badge i {
            margin-right: 4px;
            font-size: 0.9em;
        }

        /* Tags section within the card body */
        .session-tags {
            margin-top: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid #eee;
        }
        .session-tags .tag {
             background-color: var(--pelican-light);
             color: var(--lc-gray);
             border: 1px solid var(--pelican);
             font-size: 0.7rem;
             padding: 0.2rem 0.5rem;
             margin-bottom: 0.25rem;
             margin-right: 0.25rem;
        }
        .session-tags strong {
            font-size: 0.8rem;
            font-weight: 600; /* Semi-Bold label */
            color: var(--lc-gray);
            display: block;
            margin-bottom: 0.25rem;
        }


        /* Loading indicator styles */
        #loading {
            text-align: center;
            padding: 40px 20px;
            font-size: 1.2rem;
            color: var(--lc-red);
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
            margin-bottom: 1rem;
            color: var(--lc-red);
        }

        /* No results message */
        #no-results {
             margin-top: 2rem;
             padding: 1.5rem;
             font-size: 1.1rem;
        }

         /* Search button style */
         #search-button {
             border-color: var(--lc-gray);
             color: var(--lc-gray);
         }
         #search-button:hover {
             background-color: var(--lc-gray);
             color: white;
         }
         /* Clear button style */
         #clear-filters-button {
             border-color: var(--lc-red);
             color: var(--lc-red);
             font-weight: 600; /* Semi-Bold clear button */
         }
         #clear-filters-button:hover {
             background-color: var(--lc-red);
             color: white;
         }

        /* Increase spacing between card elements */
        .card-title {
            margin-bottom: 0.5rem !important; /* Increased from 0.25rem */
        }
        .card-subtitle {
            margin-bottom: 0.5rem !important; /* Increased from 0.25rem */
        }
        .session-details {
            margin-top: 0.5rem !important;    /* Increased from 0.1rem */
            margin-bottom: 0.75rem !important; /* Increased from 0.1rem */
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;  /* Increased from 0.1rem */
        }
        .session-description-wrapper {
            margin-top: 0.5rem;  /* Increased from 0.25rem */
            margin-bottom: 0.5rem;  /* Increased from 0.25rem */
        }

        /* Fix strand 2 filter button color to match card */
        .btn-filter[data-filter="strand2"] { 
            background-color: var(--brick-light); 
            border-color: var(--brick-light);
            color: white;
        }
        .btn-filter[data-filter="strand2"].active { 
            background-color: var(--brick); 
            border-color: var(--brick);
            color: white;
        }
    </style>
</head>
<body>
<header class="lc-header">
<div class="container">
<a href="#" onclick="location.reload(); return false;">
<img alt="Loomis Chaffee Logo" class="lc-logo" onerror="this.style.display='none'; console.error('Logo image not found.');" src="logo.png"/>
</a>
</div>
</header>
<div class="container py-4">
<div class="row mb-4">
<div class="col-12">
<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link active" href="index.html">Session Listing</a>
</li>
<li class="nav-item">
<a class="nav-link" href="schedule.html">Schedule</a>
</li>
<li class="nav-item">
<a class="nav-link" href="calendar.html">Calendar View</a>
</li>
</ul>
</div>
</div>
<div class="row">
<div class="col-lg-3">
<div class="filter-group-wrapper">
<div class="filter-group">
<h4 class="filter-title">Filter by Strand</h4>
<div class="filter-buttons-container" id="strand-filters">
<button class="btn btn-filter btn-filter-all active" data-filter="all" onclick="toggleFilter('strand', 'all', this)">All Strands</button>
<button class="btn btn-filter color-1" data-filter="strand1" onclick="toggleFilter('strand', 'strand1', this)">1: AI in the Classroom</button>
<button class="btn btn-filter color-2" data-filter="strand2" onclick="toggleFilter('strand', 'strand2', this)">2: Human-Centered Innovation</button>
</div>
</div>
<div class="filter-group">
<h4 class="filter-title">Filter by Time Block</h4>
<div class="filter-buttons-container" id="timeblock-filters">
<button class="btn btn-filter btn-filter-all active" data-filter="all" onclick="toggleFilter('timeblock', 'all', this)">All Time Blocks</button>
<button class="btn btn-filter color-1" data-filter="1" onclick="toggleFilter('timeblock', '1', this)">Block 1</button>
<button class="btn btn-filter color-3" data-filter="2" onclick="toggleFilter('timeblock', '2', this)">Block 2</button>
<button class="btn btn-filter color-4" data-filter="3" onclick="toggleFilter('timeblock', '3', this)">Block 3</button>
</div>
</div>
<div class="filter-group">
<h4 class="filter-title">Filter by Tag</h4>
<div class="filter-buttons-container" id="tag-filters">
<button class="btn btn-filter btn-filter-all active" data-filter="all" onclick="toggleFilter('tag', 'all', this)">All Tags</button>
</div>
</div>
<div class="filter-group">
<h4 class="filter-title">Search &amp; Clear</h4>
<div class="input-group mb-2"> <input class="form-control form-control-sm" id="search-input" placeholder="Search sessions..." type="text"/> <button class="btn btn-outline-secondary btn-sm" id="search-button" onclick="applyFilters()" type="button">
<i class="bi bi-search"></i>
</button>
</div>
<button class="btn btn-outline-secondary btn-sm w-100" id="clear-filters-button" onclick="resetAllFilters()">Clear All Filters</button> </div>
</div>
</div>
<div class="col-lg-9">
<h2 class="mb-3 header-red">Conference Sessions</h2>
<div id="loading" style="text-align: center; padding: 40px 20px; font-size: 1.2rem; color: var(--lc-red); display: none;">
<div class="spinner-border" role="status" style="width: 3rem; height: 3rem; margin-bottom: 1rem; color: var(--lc-red);">
<span class="visually-hidden">Loading...</span>
</div>
<p>Loading sessions...</p>
</div>
<div class="alert alert-info hidden" id="no-results" role="alert" style="margin-top: 2rem; padding: 1.5rem; font-size: 1.1rem; display: none;">
        No sessions match the current filters.
    </div>
<div class="row" id="sessions-container"></div>
</div>
</div>
</div>
<footer>
<div class="container">
<div class="row">
<div class="col-md-8">
<h4>Loomis Chaffee</h4>
<p class="mb-0">4 Batchelder Road, Windsor, CT 06095</p>
<!-- Copyright removed -->
</div>
</div>
</div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
        // NOTE: This script assumes the fonts 'Proxima Nova' and 'Financier Display'
        // are loaded globally via the website's main CSS or a font service.
        document.addEventListener('DOMContentLoaded', function() {
            let allSessionData = []; // Store all sessions
            const sessionsContainer = document.getElementById('sessions-container');
            // Corrected ID for searchInput
            const searchInput = document.getElementById('search-input'); 
            const loadingElement = document.getElementById('loading');
            const noResultsDiv = document.getElementById('no-results');

            // Active filters state
            let activeFilters = {
                strand: ['all'],
                timeblock: ['all'], // Assuming timeblock filter might be added later
                tag: ['all'] // Assuming tag filter might be added later
            };

            // --- Function to fetch session data ---
            async function loadSessionData() {
                if (loadingElement) loadingElement.style.display = 'block';
                try {
                    const response = await fetch('sessions.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    allSessionData = await response.json();
                    console.log("Fetched sessions:", allSessionData);

                    if (!Array.isArray(allSessionData)) {
                        console.error("Fetched data is not an array:", allSessionData);
                        allSessionData = []; // Fallback to empty array
                        if (noResultsDiv) noResultsDiv.classList.remove('hidden');
                        if (sessionsContainer) sessionsContainer.innerHTML = '<p class="text-danger text-center">Error: Session data is not in the expected format.</p>';
                        if (loadingElement) loadingElement.style.display = 'none';
                        return;
                    }

                    populateStrandFilters(allSessionData); // Populate strand filters
                    populateTagFilters(allSessionData); // Populate tag filters
                    renderSessions(allSessionData);
                    initializeFilterLogic(); 

                } catch (error) {
                    console.error('Error loading session data:', error);
                    if (sessionsContainer) sessionsContainer.innerHTML = '<p class="text-danger text-center">Could not load session data. Please try again later. Check browser console for details.</p>';
                    if (noResultsDiv) noResultsDiv.classList.add('hidden'); 
                } finally {
                    if (loadingElement) loadingElement.style.display = 'none';
                }
            }

            // --- Function to populate strand filters ---
            function populateStrandFilters(sessions) {
                const strandFiltersContainer = document.querySelector('#strand-filters .filter-buttons-container');
                if (!strandFiltersContainer) {
                    console.warn('Strand filters container not found.');
                    return;
                }

                strandFiltersContainer.innerHTML = ''; // Clear existing static buttons

                const uniqueStrands = {};
                sessions.forEach(session => {
                    if (session.strand && session.strandName) {
                        if (!uniqueStrands[session.strand]) {
                            uniqueStrands[session.strand] = session.strandName;
                        }
                    }
                });

                // Add "All Strands" button
                const allButton = document.createElement('button');
                allButton.className = 'btn-filter btn-filter-all active color-1'; // Default to active and color-1
                allButton.dataset.filter = 'all';
                allButton.textContent = 'All Strands';
                allButton.onclick = () => toggleFilter('strand', 'all', allButton);
                strandFiltersContainer.appendChild(allButton);

                // Add buttons for each unique strand
                let colorIndex = 1;
                Object.entries(uniqueStrands).forEach(([strandValue, strandName]) => {
                    const strandButton = document.createElement('button');
                    strandButton.className = `btn-filter color-${colorIndex}`;
                    strandButton.dataset.filter = strandValue;
                    strandButton.textContent = strandName;
                    strandButton.onclick = () => toggleFilter('strand', strandValue, strandButton);
                    strandFiltersContainer.appendChild(strandButton);
                    colorIndex = colorIndex === 2 ? 1 : colorIndex + 1; // Cycle through color-1, color-2 for now
                });
            }

            // --- Function to populate tag filters (NEW) ---
            function populateTagFilters(sessions) {
                const tagFiltersContainer = document.querySelector('#tag-filters .filter-buttons-container');
                if (!tagFiltersContainer) {
                    console.warn('Tag filters container not found.');
                    return;
                }

                let allTagsButton = tagFiltersContainer.querySelector('.btn-filter-all[data-filter="all"]');
                tagFiltersContainer.innerHTML = ''; 
                if (allTagsButton) {
                    tagFiltersContainer.appendChild(allTagsButton);
                } else {
                    allTagsButton = document.createElement('button');
                    allTagsButton.className = 'btn-filter btn-filter-all active';
                    allTagsButton.dataset.filter = 'all';
                    allTagsButton.textContent = 'All Tags';
                    allTagsButton.onclick = () => toggleFilter('tag', 'all', allTagsButton);
                    tagFiltersContainer.appendChild(allTagsButton);
                }

                const uniqueTags = new Set();
                sessions.forEach(session => {
                    if (session.tags && session.tags.length > 0) {
                        session.tags.forEach(tag => uniqueTags.add(tag.trim()));
                    }
                });

                let colorIndex = 1;
                Array.from(uniqueTags).sort().forEach(tagText => {
                    const tagFilterValue = tagText.toLowerCase().replace(/\\s+/g, '-').replace(/[^a-z0-9-]/g, '');
                    if (!tagFilterValue) return; // Skip empty tags

                    const tagButton = document.createElement('button');
                    tagButton.className = `btn-filter color-${((colorIndex - 1) % 5) + 1}`;
                    tagButton.dataset.filter = tagFilterValue;
                    tagButton.textContent = tagText;
                    tagButton.onclick = () => toggleFilter('tag', tagFilterValue, tagButton);
                    tagFiltersContainer.appendChild(tagButton);
                    colorIndex++;
                });
            }


            // --- Function to initialize filter button logic (if not already part of toggleFilter) ---
            function initializeFilterLogic() {
                // Ensure the "All" buttons are set to active state by default
                document.querySelectorAll('.btn-filter-all').forEach(button => {
                    button.classList.add('active');
                });
            }

            // --- Function to render sessions ---
            function renderSessions(sessionsToRender) {
                const container = document.getElementById('sessions-container');
                if (!container) {
                    console.error('Session container not found');
                    return;
                }
                container.innerHTML = ''; // Clear existing sessions

                if (sessionsToRender.length === 0) {
                    // applyFilters will handle the noResultsDiv visibility, so just ensure container is empty.
                    container.innerHTML = ''; 
                    return;
                }

                sessionsToRender.forEach(session => {
                    // Create a new div for each session card
                    const sessionCard = document.createElement('div');
                    // Changed to col-12 to make each card take the full width
                    sessionCard.className = `col-12 mb-4 session-card-wrapper`; 

                    // Determine strand class for border color
                    let strandClass = '';
                    if (session.strand) {
                        const strandNormalized = session.strand.toLowerCase().replace(/\\s+/g, '');
                        if (strandNormalized.includes('strand1') || strandNormalized.includes('aiandhumanity')) {
                            strandClass = 'strand1';
                        } else if (strandNormalized.includes('strand2') || strandNormalized.includes('rethinkingeducation')) {
                            strandClass = 'strand2';
                        } else if (strandNormalized.includes('strand3') || strandNormalized.includes('ethicalfuture')) {
                            strandClass = 'strand3';
                        } else if (session.type && session.type.toLowerCase().includes('keynote') || session.title.toLowerCase().includes('keynote') || session.title.toLowerCase().includes('welcome') || session.title.toLowerCase().includes('arrival')) {
                            strandClass = 'strandSpecial'; // For Keynotes, Welcome, etc.
                        }
                    }


                    // Determine type class for badge color
                    let typeClass = 'type-default'; // Default class
                    if (session.type) {
                        const typeNormalized = session.type.toLowerCase().replace(/\\s+/g, '-');
                        if (['workshop', 'presentation', 'discussion', 'panel', 'keynote', 'facilitated', 'special'].some(t => typeNormalized.includes(t))) {
                            if (typeNormalized.includes('workshop')) typeClass = 'type-workshop';
                            else if (typeNormalized.includes('presentation')) typeClass = 'type-presentation';
                            else if (typeNormalized.includes('discussion')) typeClass = 'type-discussion';
                            else if (typeNormalized.includes('panel')) typeClass = 'type-panel';
                            else if (typeNormalized.includes('keynote')) typeClass = 'type-keynote';
                            else if (typeNormalized.includes('facilitated')) typeClass = 'type-facilitated';
                            else if (typeNormalized.includes('special')) typeClass = 'type-special';
                            // Add more specific checks if needed
                        } else {
                            // Fallback for combined types or less common ones
                            if (typeNormalized.includes('q&a')) typeClass = 'type-presentation'; // Treat Q&A as presentation
                            else if (typeNormalized.includes('activity')) typeClass = 'type-workshop'; // Treat activity as workshop
                        }
                    }


                    // Presenter and Organization Formatting
                    let presenterHTML = '';
                    if (session.presenter && session.presenter.trim() !== '') {
                        const presenters = session.presenter.split(/,\s*(?![^()]*\))|\s+and\s+/i); // Split by comma or 'and'
                        const organizations = session.organization ? session.organization.split(/,\s*(?![^()]*\))|\s+and\s+/i) : [];
                        
                        presenterHTML = presenters.map((name, index) => {
                            let orgName = '';
                            if (organizations.length === 1) {
                                orgName = organizations[0];
                            } else if (organizations.length > index) {
                                orgName = organizations[index];
                            }
                            const org = orgName && orgName.trim() !== '' ? `<em>${orgName.trim()}</em>` : '';
                            return `<strong>${name.trim()}</strong>${org ? ' ' + org : ''}`;
                        }).join(', ');
                    }


                    // Occurrences: Time and Location
                    let occurrencesHTML = '';
                    if (session.occurrences && session.occurrences.length > 0) {
                        occurrencesHTML = session.occurrences.map(occurrence => {
                            const time = occurrence.timeBlock || occurrence.time || 'Time TBD';
                            const room = occurrence.location || occurrence.room || 'Location TBD';
                            return `<div class="session-meta-item">
                                        <i class="bi bi-clock-fill"></i> ${time}
                                        <span style="margin: 0 0.5em;">|</span>
                                        <i class="bi bi-geo-alt-fill"></i> ${room}
                                    </div>`;
                        }).join('');
                    } else { // Fallback for sessions without an occurrences array (older data structure)
                        const time = session.time || 'Time TBD';
                        const room = session.room || 'Location TBD';
                        occurrencesHTML = `
                            <div class="session-meta-item">
                                <i class="bi bi-clock-fill"></i> ${time}
                                <span style="margin: 0 0.5em;">|</span>
                                <i class="bi bi-geo-alt-fill"></i> ${room}
                            </div>`;
                    }


                    // Description with Read More/Less
                    const descriptionHTML = session.description_html || session.description || 'No description available.';
                    const uniqueDescId = `desc-${session.id || Math.random().toString(36).substr(2, 9)}`;
                    const uniqueBtnId = `btn-${session.id || Math.random().toString(36).substr(2, 9)}`;


                    sessionCard.innerHTML = `
                        <div class="session-card ${strandClass} ${typeClass}" data-session-id="${session.id}">
                            <div class="strand-indicator"></div>
                            <div class="session-type">${session.type || 'Session'}</div>
                            <h5 class="session-title"><span>${session.title}</span></h5>
                            <div class="session-presenter mb-2">${presenterHTML || 'Presenter TBD'}</div>
                            ${occurrencesHTML}
                            <div class="session-description-wrapper" id="${uniqueDescId}">
                                <div class="session-description-content">${descriptionHTML}</div>
                            </div>
                            <button class="toggle-description" id="${uniqueBtnId}" onclick="toggleDescription(event, '${uniqueDescId}', '${uniqueBtnId}')">Read more</button>
                            <div style="clear: both;"></div> <!-- Clear float for the button -->
                            <div class="session-tags mt-auto pt-2">
                                <strong>Tags:</strong> ${session.tags ? session.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : 'None'}
                            </div>
                        </div>
                    `;
                    sessionsContainer.appendChild(sessionCard);
                });
            }

            loadSessionData();

            // --- Function to toggle description visibility (NEW - uses CSS class) ---
            window.toggleDescription = function(event, wrapperId) {
                event.preventDefault();
                const element = event.currentTarget;
                const wrapper = document.getElementById(wrapperId); // Get the wrapper div
                if (wrapper) {
                    wrapper.classList.toggle('expanded'); // Toggle the class
                    // Always update the toggle button text:
                    const toggleButton = element.classList.contains('toggle-description')
                        ? element
                        : element.closest('.session-card').querySelector('.toggle-description');
                    if (toggleButton) {
                        const isExpanded = wrapper.classList.contains('expanded');
                        toggleButton.textContent = isExpanded ? 'Show Less' : 'Read More';
                    }
                } else {
                    console.warn("Could not find description wrapper for ID:", wrapperId);
                }
            }

            // --- Function to handle filter button clicks ---
            window.toggleFilter = function(group, value, element) {
                const filterGroup = activeFilters[group];
                const allButton = document.querySelector(`#${group}-filters .btn-filter-all`);

                if (value === 'all') {
                    if (!element.classList.contains('active')) {
                        document.querySelectorAll(`#${group}-filters .btn-filter`).forEach(btn => btn.classList.remove('active'));
                        element.classList.add('active');
                        activeFilters[group] = ['all'];
                    }
                } else {
                    if (allButton && allButton.classList.contains('active')) {
                        allButton.classList.remove('active');
                        activeFilters[group] = [];
                    }
                    if (element.classList.contains('active')) {
                        element.classList.remove('active');
                        activeFilters[group] = filterGroup.filter(f => f !== value);
                    } else {
                        element.classList.add('active');
                        activeFilters[group].push(value);
                    }
                    if (activeFilters[group].length === 0 && allButton) {
                        allButton.classList.add('active');
                        activeFilters[group] = ['all'];
                    }
                }
                applyFilters();
            }

            // --- Function to apply filters ---
            window.applyFilters = function() {
                const searchTerm = searchInput.value.toLowerCase().trim();
                let visibleCount = 0;
                const allSessionCards = sessionsContainer.querySelectorAll('.session-card');

                if (!allSessionData || allSessionData.length === 0) {
                    if(loadingElement && loadingElement.style.display !== 'none') {
                        return; 
                    }
                    noResultsDiv.classList.remove('hidden');
                    if (sessionsContainer) sessionsContainer.innerHTML = ''; 
                    return;
                }
                
                // If allSessionCards is empty but allSessionData has items, it means renderSessions hasn't run or cleared.
                // This can happen if initial render is empty due to filters.
                // The logic below iterates cards, so if no cards, nothing happens.
                // noResultsDiv logic at the end handles this.

                allSessionCards.forEach(card => {
                    const cardStrand = card.dataset.strand;
                    const cardTimeBlockGroups = (card.dataset.timeblockGroups || '').split(',').filter(g => g);
                    const cardRawTags = (card.dataset.tags || '').split(',').filter(t => t);
                    const cardFormattedTags = cardRawTags.map(tag => tag.toLowerCase().replace(/\\s+/g, '-').replace(/[^a-z0-9-]/g, ''));
                    
                    let showCard = true;

                    // Strand Filter
                    if (!activeFilters.strand.includes('all') && !activeFilters.strand.includes(cardStrand)) {
                        showCard = false;
                    }

                    // Time Block Filter
                    if (showCard && !activeFilters.timeblock.includes('all')) {
                        if (cardTimeBlockGroups.length === 0 && !activeFilters.timeblock.includes('none')) { // 'none' could be a filter for sessions with no assigned timeblock
                             // Or, if sessions without timeblocks should always be hidden by specific timeblock filters:
                             showCard = false;
                        } else if (activeFilters.timeblock.length > 0 && !activeFilters.timeblock.some(tb => cardTimeBlockGroups.includes(tb))) {
                            showCard = false;
                        }
                    }

                    // Tag Filter
                    if (showCard && !activeFilters.tag.includes('all')) {
                        if (cardFormattedTags.length === 0 && !activeFilters.tag.includes('none')) { // Similar 'none' logic for tags
                            showCard = false;
                        } else if (activeFilters.tag.length > 0 && !activeFilters.tag.some(activeTag => cardFormattedTags.includes(activeTag))) {
                            showCard = false;
                        }
                    }
                    
                    // Search Filter
                    if (showCard && searchTerm !== '') {
                        const title = card.querySelector('.card-title')?.textContent.toLowerCase() || '';
                        const presenter = card.querySelector('.card-subtitle')?.textContent.toLowerCase() || '';
                        // Search the actual description content now
                        const description = card.querySelector('.session-description-content')?.textContent.toLowerCase() || '';
                        const tagsText = cardFormattedTags.join(' ').toLowerCase();
                        const combinedText = `${title} ${presenter} ${description} ${tagsText}`; // Use full description for search
                        if (!combinedText.includes(searchTerm)) showCard = false;
                    }

                    // Show/Hide Card & Collapse Description if hiding
                    card.classList.toggle('hidden', !showCard);
                    if (!showCard) {
                        const wrapper = card.querySelector('.session-description-wrapper');
                        if (wrapper && wrapper.classList.contains('expanded')) {
                             wrapper.classList.remove('expanded');
                             card.querySelector('.toggle-description').textContent = 'Read More';
                        }
                    } else {
                        visibleCount++;
                    }
                });

                noResultsDiv.classList.toggle('hidden', visibleCount > 0);
            }

            // --- Function to reset filters ---
            window.resetAllFilters = function() {
                activeFilters.strand = ['all'];
                activeFilters.timeblock = ['all'];
                activeFilters.tag = ['all'];

                ['strand', 'timeblock', 'tag'].forEach(group => {
                     document.querySelectorAll(`#${group}-filters .btn-filter`).forEach(button => {
                         button.classList.toggle('active', button.dataset.filter === 'all');
                     });
                 });

                searchInput.value = '';
                applyFilters();
            }

            // --- Event Listeners ---
            // Add null check for searchInput before adding event listeners
            if (searchInput) {
                searchInput.addEventListener('input', applyFilters);
                searchInput.addEventListener('keypress', (event) => {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        applyFilters();
                    }
                });
            } else {
                console.warn('Search input element not found. Search functionality will be disabled.');
            }

        }); // End DOMContentLoaded
    </script>
</body>
</html>
